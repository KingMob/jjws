{"id":"jjs-2sy","title":"jjws redesign: relax workspace placement and naming assumptions","description":"## What\nRedesign jjsib (renamed to jjws) to relax two core assumptions: (1) workspaces must be sibling directories, and (2) workspace names must match directory names. Add config file support, subdirectory workspace placement, automatic file copying, and a name prefix system.\n\n## Why\nThe current sibling-only placement is awkward for LLM agents that need ephemeral workspaces. The name==dirname coupling was a workaround for jj <0.38 limitations that are now resolved. These changes make jjws more flexible for both human and agent workflows.\n\n## Acceptance Criteria\n- [ ] Tool renamed from jjsib/jj-worksib.sh to jjws/jj-ws.sh\n- [ ] Config file support (user-level + repo-level, KEY=VALUE format)\n- [ ] Workspace resolution works without auto-sync (uses .jj/repo detection)\n- [ ] Subdirectory workspace placement supported via config\n- [ ] Ignored files auto-copied during workspace creation via config\n- [ ] Init scripts receive JJWS_SOURCE_DIR env var\n- [ ] Name prefix support via config\n\n## Technical Notes\n- This is an epic with 8 subtask issues\n- Critical path: rename â†’ config â†’ resolution â†’ remove auto-sync\n- Parallel work possible: subdirectory support, file copying, init script env, name prefix (all depend on config)","status":"deferred","priority":0,"issue_type":"feature","created_at":"2026-02-15T08:03:00.877284Z","created_by":"matthew","updated_at":"2026-02-15T08:27:30.263330Z","source_repo":".","compaction_level":0,"original_size":0,"dependencies":[{"issue_id":"jjs-2sy","depends_on_id":"jjws-35f","type":"blocks","created_at":"2026-02-15T08:16:15.230681Z","created_by":"matthew","metadata":"{}","thread_id":""}]}
{"id":"jjs-2sy.1","title":"Rename jjsib to jjws everywhere","description":"## What\nRename all references from jjsib/jj-worksib.sh to jjws/jj-ws.sh across the entire codebase.\n\n## Why\nShorter, cleaner name that better reflects the tool's purpose (jj workspace management). Done first since every subsequent issue will use the new naming.\n\n## Acceptance Criteria\n- [ ] `jj-worksib.sh` renamed to `jj-ws.sh`\n- [ ] Shell function name: `jjsib()` â†’ `jjws()`\n- [ ] Completion function names updated (`_jjsib` â†’ `_jjws`, `_jjsib_completion` â†’ `_jjws_completion`, `__jjsib_workspaces` â†’ `__jjws_workspaces`)\n- [ ] All help text, error messages, and usage strings updated\n- [ ] `compdef _jjsib jjsib` â†’ `compdef _jjws jjws`\n- [ ] `complete -F _jjsib_completion jjsib` â†’ `complete -F _jjws_completion jjws`\n- [ ] `complete -c jjsib` â†’ `complete -c jjws` (fish completions)\n- [ ] `.jjsib-add-init.sh` legacy init script reference: drop support (it was already a deprecated fallback for `.workspace-init.sh`)\n- [ ] Test helper `run_jjsib` â†’ `run_jjws`, `SCRIPT_PATH` updated\n- [ ] CLAUDE.md updated\n- [ ] README.md updated (title, examples, installation instructions, variable names)\n- [ ] CHANGELOG.md references updated to use new naming\n- [ ] Bump VERSION to 0.5.0\n- [ ] All tests pass after rename\n\n## Technical Notes\n- Files to modify: `jj-worksib.sh` (rename + all internal refs), `tests/test_helper/common.bash`, `CLAUDE.md`, `README.md`, `CHANGELOG.md`\n- Every `.bats` test file calls `run_jjsib` â€” all need updating\n- The shell function in hook mode output is the most critical part (users eval this)\n- The repo directory name (`jjsib`) stays as-is â€” user can rename separately","status":"closed","priority":0,"issue_type":"task","created_at":"2026-02-15T08:03:16.042955Z","created_by":"matthew","updated_at":"2026-02-15T08:38:29.721299Z","closed_at":"2026-02-15T08:38:29.720699Z","close_reason":"done","source_repo":".","compaction_level":0,"original_size":0,"dependencies":[{"issue_id":"jjs-2sy.1","depends_on_id":"jjs-2sy","type":"parent-child","created_at":"2026-02-15T08:03:16.042955Z","created_by":"matthew","metadata":"{}","thread_id":""}]}
{"id":"jjs-2sy.2","title":"Add config file support (user-level and repo-level)","description":"## What\nImplement a config file system with two tiers: user-level (~/.config/jjws/config) and repo-level (.jjws.conf in repo root). Repo-level overrides user-level. Format is KEY=VALUE, one per line, with # comments.\n\n## Why\nMultiple upcoming features (subdirectory placement, file copying, name prefix) need configuration. A simple config system avoids flag proliferation and lets users set defaults once.\n\n## Acceptance Criteria\n- [ ] `load_config()` function reads user config from `~/.config/jjws/config`\n- [ ] `load_config()` reads repo config from `<repo_root>/.jjws.conf`\n- [ ] Repo-level values override user-level values\n- [ ] Supports keys: `workspace_dir`, `name_prefix`, `copy_files`\n- [ ] Missing config files are silently ignored (no error)\n- [ ] Invalid lines are warned about on stderr but don't abort\n- [ ] Config values available as shell variables: `JJWS_WORKSPACE_DIR`, `JJWS_NAME_PREFIX`, `JJWS_COPY_FILES`\n- [ ] `load_config()` called early in script execution, after jj repo detection but before mode dispatch\n- [ ] Tests cover: no config, user-only config, repo-only config, both (repo wins), invalid lines, missing files\n\n## Technical Notes\n- Parsing approach: `grep -v '^#' | grep -v '^$'` to strip comments/blanks, then `IFS='=' read key value` per line\n- Don't use `source` â€” it's a security risk (arbitrary code execution). Parse explicitly.\n- Default values: `workspace_dir=\"\"` (empty = sibling mode), `name_prefix=\"\"`, `copy_files=\"\"`\n- The repo root for config lookup should be the jj repo root (from `jj workspace root`), not necessarily the current directory\n- Config file location follows XDG convention for user-level","status":"deferred","priority":0,"issue_type":"feature","created_at":"2026-02-15T08:03:30.325560Z","created_by":"matthew","updated_at":"2026-02-15T08:27:30.250811Z","source_repo":".","compaction_level":0,"original_size":0,"dependencies":[{"issue_id":"jjs-2sy.2","depends_on_id":"jjs-2sy","type":"parent-child","created_at":"2026-02-15T08:03:30.325560Z","created_by":"matthew","metadata":"{}","thread_id":""},{"issue_id":"jjs-2sy.2","depends_on_id":"jjs-2sy.1","type":"blocks","created_at":"2026-02-15T08:04:51.763337Z","created_by":"matthew","metadata":"{}","thread_id":""},{"issue_id":"jjs-2sy.2","depends_on_id":"jjws-35f","type":"blocks","created_at":"2026-02-15T08:16:15.772282Z","created_by":"matthew","metadata":"{}","thread_id":""}]}
{"id":"jjs-2sy.3","title":"Enhance workspace directory resolution with .jj/repo detection","description":"## What\nImprove `resolve_workspace_dir()` to detect workspace locations by examining `.jj/repo` entries, adding a fallback between `jj workspace root --name` (0.38+) and the sibling path assumption.\n\n## Why\nThe current resolution tries `jj workspace root --name` first, then falls back to assuming sibling path with name==dirname. This fails for: (1) pre-0.38 default workspaces whose path isn't in the store, (2) subdirectory workspaces. The `.jj/repo` detection fills this gap without needing auto-sync.\n\n## Acceptance Criteria\n- [ ] `resolve_workspace_dir()` tries these in order: (1) `jj workspace root --name` if jj >= 0.38, (2) `.jj/repo` detection across candidate paths, (3) sibling path fallback\n- [ ] `.jj/repo` detection: if `<path>/.jj/repo` is a directory â†’ that's the main (default) workspace; if it's a file â†’ it's a secondary workspace (and the file contents point to the main repo)\n- [ ] Candidate paths checked: sibling (`$PARENT_DIR/$ws_name`) and subdirectory (`$REPO_ROOT/$JJWS_WORKSPACE_DIR/$ws_name`) if `workspace_dir` is configured\n- [ ] Works correctly for: default workspace (pre-0.38), default workspace (0.38+), jjws-created workspaces, subdirectory workspaces\n- [ ] Tests cover each resolution path\n\n## Technical Notes\n- `resolve_workspace_dir()` is at lines 46-56 of jj-worksib.sh (current)\n- The `.jj/repo` file in secondary workspaces is a text file containing the path to the shared repo store\n- For the \"find default workspace\" case: we need to identify which workspace at a candidate path is the one we're looking for â€” check `jj workspace list` output to match names\n- This needs the config system to know about `workspace_dir` for candidate path generation","status":"deferred","priority":1,"issue_type":"feature","created_at":"2026-02-15T08:03:44.911156Z","created_by":"matthew","updated_at":"2026-02-15T08:27:30.254677Z","source_repo":".","compaction_level":0,"original_size":0,"dependencies":[{"issue_id":"jjs-2sy.3","depends_on_id":"jjs-2sy","type":"parent-child","created_at":"2026-02-15T08:03:44.911156Z","created_by":"matthew","metadata":"{}","thread_id":""},{"issue_id":"jjs-2sy.3","depends_on_id":"jjs-2sy.2","type":"blocks","created_at":"2026-02-15T08:04:51.832503Z","created_by":"matthew","metadata":"{}","thread_id":""},{"issue_id":"jjs-2sy.3","depends_on_id":"jjws-35f","type":"blocks","created_at":"2026-02-15T08:16:16.404715Z","created_by":"matthew","metadata":"{}","thread_id":""}]}
{"id":"jjs-2sy.4","title":"Remove auto-sync of workspace name to directory name","description":"## What\nRemove the auto-sync block that renames the current workspace to match its directory basename on every invocation.\n\n## Why\nAuto-sync was needed when name==dirname was the only resolution strategy. With enhanced `.jj/repo` detection and `jj workspace root --name` (0.38+), workspace names no longer need to match directory names. Auto-sync actively interferes with subdirectory workspaces and name prefixes.\n\n## Acceptance Criteria\n- [ ] Auto-sync block removed (currently lines 616-624: detects basename mismatch and calls `jj workspace rename`)\n- [ ] No workspace renaming happens implicitly on script invocation\n- [ ] Existing tests updated â€” remove/update `tests/auto_sync.bats` (tests for auto-sync behavior should be removed; any tests that relied on auto-sync side effects should use explicit workspace names)\n- [ ] All other tests still pass (they shouldn't depend on auto-sync since test repos are freshly created)\n\n## Technical Notes\n- The auto-sync block is between jj repo detection and mode validation\n- `tests/auto_sync.bats` contains the dedicated tests for this feature â€” review and remove/rewrite\n- Check if any other test implicitly relies on auto-sync (e.g., creating a workspace then expecting the name to auto-adjust)","status":"deferred","priority":1,"issue_type":"task","created_at":"2026-02-15T08:03:55.995662Z","created_by":"matthew","updated_at":"2026-02-15T08:27:30.255786Z","source_repo":".","compaction_level":0,"original_size":0,"dependencies":[{"issue_id":"jjs-2sy.4","depends_on_id":"jjs-2sy","type":"parent-child","created_at":"2026-02-15T08:03:55.995662Z","created_by":"matthew","metadata":"{}","thread_id":""},{"issue_id":"jjs-2sy.4","depends_on_id":"jjs-2sy.3","type":"blocks","created_at":"2026-02-15T08:04:51.900630Z","created_by":"matthew","metadata":"{}","thread_id":""},{"issue_id":"jjs-2sy.4","depends_on_id":"jjws-35f","type":"blocks","created_at":"2026-02-15T08:16:16.920304Z","created_by":"matthew","metadata":"{}","thread_id":""}]}
{"id":"jjs-2sy.5","title":"Support subdirectory workspace placement","description":"## What\nWhen `workspace_dir` is set in config (e.g., `.workspaces`), create new workspaces under `<repo_root>/<workspace_dir>/<name>` instead of as sibling directories.\n\n## Why\nLLM agents benefit from subdirectory workspaces: cleaner layout, easier cleanup (nuke one directory), no sibling directory clutter. Sibling remains the default for backwards compatibility.\n\n## Acceptance Criteria\n- [ ] When `workspace_dir` is set and non-empty, `add` creates workspaces at `<repo_root>/<workspace_dir>/<name>`\n- [ ] When `workspace_dir` is empty/unset, behavior is unchanged (sibling placement)\n- [ ] The workspace directory parent (e.g., `.workspaces/`) is auto-created if it doesn't exist\n- [ ] `forget` correctly deletes subdirectory workspaces\n- [ ] `switch` correctly navigates to subdirectory workspaces\n- [ ] `rename` correctly moves subdirectory workspaces\n- [ ] `list` works regardless of placement mode\n- [ ] Help text and usage examples mention the `workspace_dir` config option\n- [ ] If `workspace_dir` is set and the directory doesn't exist yet, warn about adding it to `.gitignore` (stderr, non-fatal)\n- [ ] Tests cover: add/forget/switch/rename in subdirectory mode\n\n## Technical Notes\n- The key change is in `resolve_workspace_dir()` and the `SIBLING_PATH` computation in the `add` mode validation block\n- `PARENT_DIR` concept may need rethinking â€” currently it's always `dirname \"$WS_ROOT\"`, but for subdirectory mode it should be `$WS_ROOT/$JJWS_WORKSPACE_DIR`\n- Consider renaming `SIBLING_PATH` to `WS_PATH` since it's no longer necessarily a sibling\n- The `.gitignore` warning: check if `workspace_dir` value appears in `.gitignore` â€” if not, print a one-time warning","status":"deferred","priority":2,"issue_type":"feature","created_at":"2026-02-15T08:04:09.228193Z","created_by":"matthew","updated_at":"2026-02-15T08:27:30.256856Z","source_repo":".","compaction_level":0,"original_size":0,"dependencies":[{"issue_id":"jjs-2sy.5","depends_on_id":"jjs-2sy","type":"parent-child","created_at":"2026-02-15T08:04:09.228193Z","created_by":"matthew","metadata":"{}","thread_id":""},{"issue_id":"jjs-2sy.5","depends_on_id":"jjs-2sy.2","type":"blocks","created_at":"2026-02-15T08:04:51.965053Z","created_by":"matthew","metadata":"{}","thread_id":""},{"issue_id":"jjs-2sy.5","depends_on_id":"jjws-35f","type":"blocks","created_at":"2026-02-15T08:16:17.478373Z","created_by":"matthew","metadata":"{}","thread_id":""}]}
{"id":"jjs-2sy.6","title":"Auto-copy ignored files on workspace creation","description":"## What\nDuring `add`, automatically copy files listed in the `copy_files` config key from the source workspace to the new workspace.\n\n## Why\nThe most common workspace init script use case is copying .env files and similar ignored config. Making this a first-class config option eliminates the need for init scripts in the common case.\n\n## Acceptance Criteria\n- [ ] Reads `copy_files` from config (comma-separated list of paths relative to repo root, e.g., `.env,.env.local,.tool-versions`)\n- [ ] During `add`, copies each listed file from the current workspace root to the new workspace\n- [ ] Files that don't exist in the source are silently skipped (no error)\n- [ ] Copy happens before the init script runs (so init scripts can reference/modify the copied files)\n- [ ] Informational message on stderr for each file copied (e.g., \"ðŸ“‹ Copied .env\")\n- [ ] Glob patterns NOT supported (keep it simple â€” explicit paths only)\n- [ ] Tests cover: files copied, missing files skipped, copy happens before init script\n\n## Technical Notes\n- Implementation: loop over `IFS=',' read` of `$JJWS_COPY_FILES`, `cp` each file if it exists\n- Copy source is `$WS_ROOT/<file>` (current workspace), destination is `$WS_PATH/<file>` (new workspace)\n- Nested paths (e.g., `config/.secrets.json`) should work â€” create parent dirs with `mkdir -p` as needed\n- This runs in the `add|create` case block, after `jj workspace add` succeeds but before init script execution","status":"deferred","priority":2,"issue_type":"feature","created_at":"2026-02-15T08:04:21.592456Z","created_by":"matthew","updated_at":"2026-02-15T08:27:30.258202Z","source_repo":".","compaction_level":0,"original_size":0,"dependencies":[{"issue_id":"jjs-2sy.6","depends_on_id":"jjs-2sy","type":"parent-child","created_at":"2026-02-15T08:04:21.592456Z","created_by":"matthew","metadata":"{}","thread_id":""},{"issue_id":"jjs-2sy.6","depends_on_id":"jjs-2sy.2","type":"blocks","created_at":"2026-02-15T08:04:52.029597Z","created_by":"matthew","metadata":"{}","thread_id":""},{"issue_id":"jjs-2sy.6","depends_on_id":"jjws-35f","type":"blocks","created_at":"2026-02-15T08:16:18.052138Z","created_by":"matthew","metadata":"{}","thread_id":""}]}
{"id":"jjs-2sy.7","title":"Pass JJWS_SOURCE_DIR env var to workspace init scripts","description":"## What\nSet the `JJWS_SOURCE_DIR` environment variable when executing `.workspace-init.sh`, pointing to the workspace root where the `add` command was invoked.\n\n## Why\nInit scripts currently have no reliable way to reference the source workspace. With subdirectory placement, the source workspace is no longer necessarily a sibling, so path assumptions break. An explicit env var solves this cleanly.\n\n## Acceptance Criteria\n- [ ] `JJWS_SOURCE_DIR` is set to `$WS_ROOT` (the workspace root where `add` was run) before executing the init script\n- [ ] The env var is available inside `.workspace-init.sh`\n- [ ] Help text for `add` mode documents the env var\n- [ ] Test: init script reads `JJWS_SOURCE_DIR` and it matches the source workspace path\n\n## Technical Notes\n- Implementation: `JJWS_SOURCE_DIR=\"$WS_ROOT\" bash \"./$INIT_SCRIPT\"` (currently at ~line 766)\n- Small, focused change â€” just prefix the bash invocation with the env var export\n- This is independent of most other work â€” only depends on the rename (issue 1) for the env var name","status":"deferred","priority":2,"issue_type":"feature","created_at":"2026-02-15T08:04:31.041562Z","created_by":"matthew","updated_at":"2026-02-15T08:27:30.259571Z","source_repo":".","compaction_level":0,"original_size":0,"dependencies":[{"issue_id":"jjs-2sy.7","depends_on_id":"jjs-2sy","type":"parent-child","created_at":"2026-02-15T08:04:31.041562Z","created_by":"matthew","metadata":"{}","thread_id":""},{"issue_id":"jjs-2sy.7","depends_on_id":"jjs-2sy.1","type":"blocks","created_at":"2026-02-15T08:04:52.092688Z","created_by":"matthew","metadata":"{}","thread_id":""},{"issue_id":"jjs-2sy.7","depends_on_id":"jjws-35f","type":"blocks","created_at":"2026-02-15T08:16:18.694845Z","created_by":"matthew","metadata":"{}","thread_id":""}]}
{"id":"jjs-2sy.8","title":"Support mandatory workspace name prefix via config","description":"## What\nWhen `name_prefix` is set in config, automatically prepend it to workspace names during `add`. Other commands (`switch`, `forget`, `rename`) should accept both the bare name and the prefixed name, resolving to the prefixed version.\n\n## Why\nName prefixes help disambiguate workspaces, especially when multiple repos share a parent directory or when agents create many workspaces. E.g., prefix \"agent-\" ensures all agent workspaces are visually grouped.\n\n## Acceptance Criteria\n- [ ] During `add`, if `name_prefix` is set, the effective workspace name becomes `<prefix><name>` (e.g., `agent-` + `task-42` = `agent-task-42`)\n- [ ] Directory name matches the prefixed workspace name\n- [ ] `switch`, `forget`, `rename` accept both `task-42` and `agent-task-42` â€” if the bare name doesn't match a workspace but `<prefix><name>` does, use the prefixed version\n- [ ] `add` shows the effective (prefixed) name in output\n- [ ] Help text documents the `name_prefix` config key\n- [ ] Tests cover: prefix applied on add, switch/forget resolve bare name, explicit prefixed name also works, no prefix when config is empty\n\n## Technical Notes\n- Resolution logic: in `switch`/`forget`/`rename` validation blocks, after `validate_workspace_name`, check if the workspace exists; if not and `JJWS_NAME_PREFIX` is set, try `${JJWS_NAME_PREFIX}${WORKSPACE_NAME}`. Update `WORKSPACE_NAME` if the prefixed version matches.\n- \"Workspace exists\" check: `jj workspace list --ignore-working-copy | grep -q \"^${name}:\"`\n- In `add`, always apply prefix: `WORKSPACE_NAME=\"${JJWS_NAME_PREFIX}${WORKSPACE_NAME}\"`\n- The prefix should only contain characters valid in workspace names (alphanumeric, dots, underscores, hyphens)","status":"deferred","priority":3,"issue_type":"feature","created_at":"2026-02-15T08:04:43.850954Z","created_by":"matthew","updated_at":"2026-02-15T08:27:30.260892Z","source_repo":".","compaction_level":0,"original_size":0,"dependencies":[{"issue_id":"jjs-2sy.8","depends_on_id":"jjs-2sy","type":"parent-child","created_at":"2026-02-15T08:04:43.850954Z","created_by":"matthew","metadata":"{}","thread_id":""},{"issue_id":"jjs-2sy.8","depends_on_id":"jjs-2sy.2","type":"blocks","created_at":"2026-02-15T08:04:52.173850Z","created_by":"matthew","metadata":"{}","thread_id":""},{"issue_id":"jjs-2sy.8","depends_on_id":"jjws-35f","type":"blocks","created_at":"2026-02-15T08:16:19.254510Z","created_by":"matthew","metadata":"{}","thread_id":""}]}
{"id":"jjws-35f","title":"Rewrite jjws in Go using Charm libraries","description":"## What\nRewrite jjws from a bash script into a Go CLI application built on the Charm ecosystem (bubbletea, bubbles, glamour, lipgloss, etc).\n\n## Why\nGo provides better error handling, testability, cross-platform support, and a richer TUI experience via Charm libraries. This is a prerequisite for all further feature work on jjws.\n\n## Technical Notes\n- This is a placeholder epic â€” subtasks will be fleshed out separately\n- Blocks all existing feature work except the rename (jjs-2sy.1), which applies to the current bash codebase\n- Charm libraries: bubbletea (TUI framework), bubbles (components), glamour (markdown rendering), lipgloss (styling), huh (forms)","status":"open","priority":0,"issue_type":"feature","created_at":"2026-02-15T08:16:11.008904Z","created_by":"matthew","updated_at":"2026-02-15T08:42:15.823283Z","source_repo":".","compaction_level":0,"original_size":0}
